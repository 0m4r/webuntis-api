{"version":3,"file":"webuntis.js","sources":["../src/cookie.ts","../src/base-64.ts","../src/types.ts","../src/base.ts","../src/secret.ts","../src/qr.ts","../src/anonymous.ts"],"sourcesContent":["/**\n * Shamelessly stolen from @tinyhttp/cookie.\n *\n * Because @tinyhttp/cookie doesn't provide a commonjs build, I just decided to include the source code.\n * We need a cjs build, because we generate both esm and cjs.\n */\n\nconst pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\n// eslint-disable-next-line no-control-regex\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\nfunction tryDecode(str: string, decode: (str: string) => string) {\n    try {\n        return decode(str);\n    } catch (e) {\n        return str;\n    }\n}\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n */\nexport function parse(\n    str: string,\n    options: {\n        decode: (str: string) => string;\n    } = {\n        decode: decodeURIComponent,\n    },\n): Record<string, string> {\n    const obj: Record<string, string> = {};\n    const pairs = str.split(pairSplitRegExp);\n\n    for (const pair of pairs) {\n        let eqIdx = pair.indexOf('=');\n\n        // skip things that don't look like key=value\n        if (eqIdx < 0) continue;\n\n        const key = pair.substring(0, eqIdx).trim();\n        let val = pair.substring(++eqIdx, pair.length).trim();\n\n        // quoted values\n        if ('\"' == val[0]) val = val.slice(1, -1);\n\n        // only assign once\n        if (obj[key] == null) obj[key] = tryDecode(val, options.decode);\n    }\n\n    return obj;\n}\n\nexport type SerializeOptions = Partial<{\n    encode: (str: string) => string;\n    maxAge: number;\n    domain: string;\n    path: string;\n    httpOnly: boolean;\n    secure: boolean;\n    sameSite: boolean | 'Strict' | 'strict' | 'Lax' | 'lax' | 'None' | 'none' | string;\n    expires: Date;\n}>;\n\nexport function serialize(name: string, val: string, opt: SerializeOptions = {}): string {\n    if (!opt.encode) opt.encode = encodeURIComponent;\n\n    if (!fieldContentRegExp.test(name)) throw new TypeError('argument name is invalid');\n\n    const value = opt.encode(val);\n\n    if (value && !fieldContentRegExp.test(value)) throw new TypeError('argument val is invalid');\n\n    let str = name + '=' + value;\n\n    if (null != opt.maxAge) {\n        const maxAge = opt.maxAge - 0;\n\n        if (isNaN(maxAge) || !isFinite(maxAge)) throw new TypeError('option maxAge is invalid');\n\n        str += '; Max-Age=' + Math.floor(maxAge);\n    }\n\n    if (opt.domain) {\n        if (!fieldContentRegExp.test(opt.domain)) throw new TypeError('option domain is invalid');\n\n        str += '; Domain=' + opt.domain;\n    }\n\n    if (opt.path) {\n        if (!fieldContentRegExp.test(opt.path)) throw new TypeError('option path is invalid');\n\n        str += '; Path=' + opt.path;\n    }\n\n    if (opt.expires) str += '; Expires=' + opt.expires.toUTCString();\n\n    if (opt.httpOnly) str += '; HttpOnly';\n\n    if (opt.secure) str += '; Secure';\n\n    if (opt.sameSite) {\n        const sameSite = typeof opt.sameSite === 'string' ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n        switch (sameSite) {\n            case true:\n            case 'strict':\n                str += '; SameSite=Strict';\n                break;\n            case 'lax':\n                str += '; SameSite=Lax';\n                break;\n            case 'none':\n                str += '; SameSite=None';\n                break;\n            default:\n                throw new TypeError('option sameSite is invalid');\n        }\n    }\n\n    return str;\n}\n","const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nexport function btoa(input = '') {\n    let str = input;\n    let output = '';\n\n    for (\n        let block = 0, charCode, i = 0, map = chars;\n        str.charAt(i | 0) || ((map = '='), i % 1);\n        output += map.charAt(63 & (block >> (8 - (i % 1) * 8)))\n    ) {\n        charCode = str.charCodeAt((i += 3 / 4));\n\n        if (charCode > 0xff) {\n            throw new Error(\"'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.\");\n        }\n\n        block = (block << 8) | charCode;\n    }\n\n    return output;\n}\n","export interface SchoolYear {\n    name: string;\n    id: number;\n    startDate: Date;\n    endDate: Date;\n}\n\nexport interface MessagesOfDay {\n    id: number;\n    subject: string;\n    text: string;\n    isExpanded: boolean;\n    /**\n     * Unknown type. I have never seen this in use.\n     */\n    attachments: any[];\n}\n\nexport interface NewsWidget {\n    /**\n     * Unknown type. I have never seen this in use.\n     */\n    systemMessage: any;\n    messagesOfDay: MessagesOfDay[];\n    rssUrl: string;\n}\n\nexport interface Messagesender {\n    userId: number;\n    displayName: string;\n    imageUrl: string;\n    className: string;\n}\n\nexport interface Inboxmessage {\n    allowMessageDeletion: boolean;\n    contentPreview: string;\n    hasAttachments: boolean;\n    id: number;\n    isMessageRead: boolean;\n    isReply: boolean;\n    isReplyAllowed: boolean;\n    sender: Messagesender;\n    sentDateTime: string;\n    subject: string;\n}\n\nexport interface Inbox {\n    incomingMessages: Inboxmessage[];\n}\n\nexport interface ShortData {\n    id: number;\n    name: string;\n    longname: string;\n    orgname?: string;\n    orgid?: number;\n}\n\nexport interface Lesson {\n    id: number;\n    date: number;\n    startTime: number;\n    endTime: number;\n    kl: ShortData[];\n    te: ShortData[];\n    su: ShortData[];\n    ro: ShortData[];\n    lstext?: string;\n    lsnumber: number;\n    activityType?: 'Unterricht' | string;\n    code?: 'cancelled' | 'irregular';\n    info?: string;\n    substText?: string;\n    statflags?: string;\n    sg?: string;\n    bkRemark?: string;\n    bkText?: string;\n}\n\nexport interface Homework {\n    /**\n     * Unknown type. I have never seen this in use.\n     */\n    attachments: Array<any>;\n    completed: boolean;\n    date: number;\n    dueDate: number;\n    id: number;\n    lessonId: number;\n    remark: string;\n    text: string;\n}\n\nexport interface Subject {\n    id: number;\n    name: string;\n    longName: string;\n    alternateName: string | '';\n    active: boolean;\n    foreColor: string;\n    backColor: string;\n}\n\nexport enum WebUntisDay {\n    Sunday = 1,\n    Monday = 2,\n    Tuesday = 3,\n    Wednesday = 4,\n    Thursday = 5,\n    Friday = 6,\n    Saturday = 7,\n}\n\nexport interface TimeUnit {\n    name: string;\n    startTime: number;\n    endTime: number;\n}\n\nexport interface Timegrid {\n    day: WebUntisDay;\n    timeUnits: TimeUnit[];\n}\n\nexport interface Exam {\n    id: number;\n    examType: string;\n    name: string;\n    studentClass: string[];\n    assignedStudents: {\n        klasse: { id: number; name: string };\n        displayName: string;\n        id: number;\n    }[];\n    examDate: number;\n    startTime: number;\n    endTime: number;\n    subject: string;\n    teachers: string[];\n    rooms: string[];\n    text: string;\n    grade?: string;\n}\n\nexport enum WebUntisElementType {\n    CLASS = 1,\n    TEACHER = 2,\n    SUBJECT = 3,\n    ROOM = 4,\n    STUDENT = 5,\n}\n\nexport interface WebElement {\n    type: WebUntisElementType;\n    id: number;\n    orgId: number;\n    missing: boolean;\n    state: 'REGULAR' | 'ABSENT' | 'SUBSTITUTED';\n}\n\nexport interface WebElementData extends WebElement {\n    element: {\n        type: number;\n        id: number;\n        name: string;\n        longName?: string;\n        displayname?: string;\n        alternatename?: string;\n        canViewTimetable: boolean;\n        externalKey?: string;\n        roomCapacity: number;\n    };\n}\n\nexport interface WebAPITimetable {\n    id: number;\n    lessonId: number;\n    lessonNumber: number;\n    lessonCode: string;\n    lessonText: string;\n    periodText: string;\n    hasPeriodText: false;\n    periodInfo: string;\n    periodAttachments: [];\n    substText: string;\n    date: number;\n    startTime: number;\n    endTime: number;\n    elements: WebElement[];\n    studentGroup: string;\n    hasInfo: boolean;\n    code: number;\n    cellState: 'STANDARD' | 'SUBSTITUTION' | 'ROOMSUBSTITUTION';\n    priority: number;\n    is: {\n        roomSubstitution?: boolean;\n        substitution?: boolean;\n        standard?: boolean;\n        event: boolean;\n    };\n    roomCapacity: number;\n    studentCount: number;\n    classes: WebElementData[];\n    teachers: WebElementData[];\n    subjects: WebElementData[];\n    rooms: WebElementData[];\n    students: WebElementData[];\n}\n\nexport interface Teacher {\n    id: number;\n    name: string;\n    foreName: string;\n    longName: string;\n    foreColor: string;\n    backColor: string;\n}\n\nexport interface Student {\n    id: number;\n    key: number;\n    name: string;\n    foreName: string;\n    longName: string;\n    gender: string;\n}\n\nexport interface Room {\n    id: number;\n    name: string;\n    longName: string;\n    alternateName: string | '';\n    active: boolean;\n    foreColor: string;\n    backColor: string;\n}\n\nexport interface Klasse {\n    id: number;\n    name: string;\n    longName: string;\n    active: boolean;\n    foreColor?: string;\n    backColor?: string;\n    did?: number;\n    teacher1?: number;\n    teacher2?: number;\n}\n\nexport interface Department {\n    id: number;\n    name: string;\n    longName: string;\n}\n\nexport interface Holiday {\n    name: string;\n    longName: string;\n    id: number;\n    startDate: number;\n    endDate: number;\n}\n\nexport interface ColorEntity {\n    foreColor: string;\n    backColor: string;\n}\n\nexport interface LsEntity {\n    ls?: ColorEntity | null;\n    oh?: ColorEntity | null;\n    sb?: ColorEntity | null;\n    bs?: ColorEntity | null;\n    ex?: ColorEntity | null;\n}\n\nexport interface CodesEntity {\n    cancelled?: ColorEntity | null;\n    irregular?: ColorEntity | null;\n}\n\nexport interface StatusData {\n    lstypes: LsEntity[];\n    codes: CodesEntity[];\n}\n\nexport interface Absences {\n    absences: Absence[];\n    absenceReasons: [];\n    excuseStatuses: boolean;\n    showAbsenceReasonChange: boolean;\n    showCreateAbsence: boolean;\n}\n\nexport interface Absence {\n    id: number;\n    startDate: number;\n    endDate: number;\n    startTime: number;\n    endTime: number;\n    createDate: number;\n    lastUpdate: number;\n    createdUser: string;\n    updatedUser: string;\n    reasonId: number;\n    reason: string;\n    text: string;\n    interruptions: [];\n    canEdit: boolean;\n    studentName: string;\n    excuseStatus: string;\n    isExcused: boolean;\n    excuse: Excuse;\n}\n\nexport interface Excuse {\n    id: number;\n    text: string;\n    excuseDate: number;\n    excuseStatus: string;\n    isExcused: boolean;\n    userId: number;\n    username: string;\n}\n","import { serialize } from './cookie';\n\nimport { btoa } from './base-64';\nimport { parse as fnsParse, startOfDay, format, type ParseOptions } from 'date-fns';\n\nimport type {\n    Absences,\n    Department,\n    Exam,\n    Holiday,\n    Homework,\n    Inbox,\n    Klasse,\n    Lesson,\n    NewsWidget,\n    Room,\n    SchoolYear,\n    StatusData,\n    Student,\n    Subject,\n    Teacher,\n    Timegrid,\n    WebAPITimetable,\n} from './types';\nimport type { InternalSchoolYear, SessionInformation } from './internal';\nimport { WebUntisElementType } from './types';\n\n/**\n * Ensures that the dateStr is a string when calling {@link fnsParse}.\n * This is needed since some WebUntis servers return numbers instead of strings.\n * @param dateStr {string | number}\n * @param formatStr {string}\n * @param referenceDate {DateType | number | string}\n * @param options {ParseOptions | undefined}\n * @returns\n */\nconst parse = <DateType extends Date>(\n    dateStr: string | number,\n    formatStr: string,\n    referenceDate: DateType | number | string,\n    options?: ParseOptions,\n) => {\n    return fnsParse(`${dateStr}`, formatStr, referenceDate, options);\n};\n\nexport class Base {\n    school: string;\n    schoolbase64: string;\n    username: string;\n    password: string;\n    baseurl?: string;\n    cookies: string[];\n    id: string;\n    sessionInformation: SessionInformation | null;\n    anonymous: boolean;\n\n    baseHeaders: Record<string, string>;\n\n    static TYPES = WebUntisElementType;\n\n    /**\n     * Custom fetch wrapper that provides axios-like functionality\n     * @protected\n     */\n    protected async _fetch(\n        url: string,\n        options: {\n            method?: string;\n            searchParams?: Record<string, any>;\n            headers?: Record<string, string>;\n            body?: any;\n            expectText?: boolean;\n        } = {},\n    ): Promise<any> {\n        const { method = 'GET', searchParams = {}, headers = {}, body, expectText = false } = options;\n\n        // Build URL with search parameters\n        const fullUrl = new URL(url, this.baseurl);\n        Object.entries(searchParams).forEach(([key, value]) => {\n            if (value === undefined || value === null) return;\n            fullUrl.searchParams.append(key, value.toString());\n        });\n\n        // Prepare request options\n        const fetchOptions: RequestInit = {\n            method,\n            redirect: 'manual',\n            headers: {\n                ...this.baseHeaders,\n                ...headers,\n            },\n        };\n\n        // Add body for POST/PUT requests\n        if (body && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {\n            if (typeof body === 'object') {\n                fetchOptions.headers = {\n                    ...fetchOptions.headers,\n                    'Content-Type': 'application/json',\n                };\n                fetchOptions.body = JSON.stringify(body);\n            } else {\n                fetchOptions.body = body;\n            }\n        }\n\n        // Make the request\n        const response = await fetch(fullUrl.toString(), fetchOptions);\n\n        // Handle status validation (similar to axios validateStatus)\n        if (!(response.status >= 200 && response.status < 303)) {\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        // Parse response\n        if (expectText) {\n            return await response.text();\n        }\n\n        const contentType = response.headers.get('content-type');\n        if (contentType && contentType.includes('application/json')) {\n            return await response.json();\n        }\n\n        return await response.text();\n    }\n\n    /**\n     * Raw fetch method that returns the Response object\n     * @protected\n     */\n    protected async _fetchRaw(\n        url: string,\n        options: {\n            method?: string;\n            searchParams?: Record<string, any>;\n            headers?: Record<string, string>;\n            body?: any;\n        } = {},\n    ): Promise<Response> {\n        const { method = 'GET', searchParams = {}, headers = {}, body } = options;\n\n        // Build URL with search parameters\n        const fullUrl = new URL(url, this.baseurl);\n        Object.entries(searchParams).forEach(([key, value]) => {\n            if (value === undefined || value === null) return;\n            fullUrl.searchParams.append(key, value.toString());\n        });\n\n        // Prepare request options\n        const fetchOptions: RequestInit = {\n            method,\n            redirect: 'manual',\n            headers: {\n                ...this.baseHeaders,\n                ...headers,\n            },\n        };\n\n        // Add body for POST/PUT requests\n        if (body && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {\n            if (typeof body === 'object') {\n                fetchOptions.headers = {\n                    ...fetchOptions.headers,\n                    'Content-Type': 'application/json',\n                };\n                fetchOptions.body = JSON.stringify(body);\n            } else {\n                fetchOptions.body = body;\n            }\n        }\n\n        // Make the request and return raw response\n        return await fetch(fullUrl.toString(), fetchOptions);\n    }\n\n    /**\n     * @param {string} school The school identifier\n     * @param {string} username\n     * @param {string} password\n     * @param {string} baseurl Just the host name of your WebUntis (Example: [school].webuntis.com)\n     * @param {string} [identity=\"Awesome\"] A identity like: MyAwesomeApp\n\n     * @param {boolean} [disableUserAgent=false] If this is true, fetch will not send a custom User-Agent\n     */\n    constructor(\n        school: string,\n        username: string,\n        password: string,\n        baseurl?: string,\n        identity = 'Awesome',\n        disableUserAgent = false,\n    ) {\n        this.school = school;\n        this.schoolbase64 = '_' + btoa(this.school);\n        this.username = username;\n        this.password = password;\n        this.baseurl = 'https://' + (baseurl ? baseurl : `${school}.webuntis.com`) + '/';\n        this.cookies = [];\n        this.id = identity;\n        this.sessionInformation = {};\n        this.anonymous = false;\n\n        this.baseHeaders = {\n            'Cache-Control': 'no-cache',\n            Pragma: 'no-cache',\n            'X-Requested-With': 'XMLHttpRequest',\n        };\n\n        if (!disableUserAgent) {\n            this.baseHeaders['User-Agent'] =\n                'Mozilla/5.0 (Macintosh; Intel Mac OS X 15_7_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.0 Safari/605.1.15';\n        }\n    }\n\n    /**\n     * Logout the current session\n     */\n    async logout(): Promise<boolean> {\n        await this._fetch('/WebUntis/jsonrpc.do', {\n            method: 'POST',\n\n            searchParams: {\n                school: this.school,\n            },\n\n            body: {\n                id: this.id,\n                method: 'logout',\n                params: {},\n                jsonrpc: '2.0',\n            },\n        });\n        this.sessionInformation = null;\n        return true;\n    }\n\n    /**\n     * Login with your credentials\n     *\n     * **Notice: The server may revoke this session after less than 10min of idle.**\n     *\n     * *Untis says in the official docs:*\n     * > An application should always log out as soon as possible to free system resources on the server.\n     */\n    async login(): Promise<SessionInformation> {\n        const response = await this._fetch('/WebUntis/jsonrpc.do', {\n            method: 'POST',\n\n            searchParams: {\n                school: this.school,\n            },\n\n            body: {\n                id: this.id,\n                method: 'authenticate',\n                params: {\n                    user: this.username,\n                    password: this.password,\n                    client: this.id,\n                },\n                jsonrpc: '2.0',\n            },\n        });\n\n        if (typeof response !== 'object') throw new Error('Failed to parse server response.');\n        if (!response.result) throw new Error('Failed to login. ' + JSON.stringify(response));\n        if (response.result.code) throw new Error('Login returned error code: ' + response.result.code);\n        if (!response.result.sessionId) throw new Error('Failed to login. No session id.');\n        this.sessionInformation = response.result;\n        return response.result;\n    }\n\n    /**\n     * Get the latest WebUntis Schoolyear\n     * @param {Boolean} [validateSession=true]\n     */\n    async getLatestSchoolyear(validateSession = true): Promise<SchoolYear> {\n        const data = await this._request<InternalSchoolYear[]>('getSchoolyears', {}, validateSession);\n        data.sort((a, b) => {\n            const na = parse(a.startDate, 'yyyyMMdd', new Date());\n            const nb = parse(b.startDate, 'yyyyMMdd', new Date());\n            return nb.getTime() - na.getTime();\n        });\n        if (!data[0]) throw new Error('Failed to receive school year');\n        return {\n            name: data[0].name,\n            id: data[0].id,\n            startDate: parse(data[0].startDate, 'yyyyMMdd', new Date()),\n            endDate: parse(data[0].endDate, 'yyyyMMdd', new Date()),\n        };\n    }\n\n    /**\n     * Get all WebUntis Schoolyears\n     * @param {Boolean} [validateSession=true]\n     */\n    async getSchoolyears(validateSession = true): Promise<SchoolYear[]> {\n        const data = await this._request<InternalSchoolYear[]>('getSchoolyears', {}, validateSession);\n        data.sort((a, b) => {\n            const na = parse(a.startDate, 'yyyyMMdd', new Date());\n            const nb = parse(b.startDate, 'yyyyMMdd', new Date());\n            return nb.getTime() - na.getTime();\n        });\n        if (!data[0]) throw new Error('Failed to receive school year');\n        return data.map((year) => {\n            return {\n                name: year.name,\n                id: year.id,\n                startDate: parse(year.startDate, 'yyyyMMdd', new Date()),\n                endDate: parse(year.endDate, 'yyyyMMdd', new Date()),\n            };\n        });\n    }\n\n    /**\n     * Get News Widget\n     * @param {Date} date\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise<Object>} see index.d.ts NewsWidget\n     */\n    async getNewsWidget(date: Date, validateSession = true): Promise<NewsWidget> {\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch('/WebUntis/api/public/news/newsWidgetData', {\n            method: 'GET',\n\n            searchParams: {\n                date: Base.convertDateToUntis(date),\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof response.data !== 'object')\n            throw new Error(`Server returned invalid data: expected data object, got ${typeof response.data}`);\n\n        return response.data;\n    }\n\n    /**\n     * Get Inbox\n     */\n    async getInbox(validateSession = true): Promise<Inbox> {\n        this._checkAnonymous();\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n        //first get JWT Token\n        const s = this.getSessionInfo();\n        if (typeof s.jwt_token != 'string') await this._getJWT();\n\n        const response = await this._fetch('/WebUntis/api/rest/view/v1/messages', {\n            method: 'GET',\n\n            headers: {\n                Authorization: `Bearer ${s.jwt_token}`,\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof response !== 'object')\n            throw new Error(`Server returned invalid data: expected object, got ${typeof response}`);\n\n        return response;\n    }\n\n    private _checkAnonymous() {\n        if (this.anonymous) {\n            throw new Error('This method is not supported with anonymous login');\n        }\n    }\n\n    /**\n     * Return the current session information or throw if not present\n     * @private\n     */\n    private getSessionInfo(): SessionInformation {\n        if (!this.sessionInformation) throw new Error('Session not initialized');\n        return this.sessionInformation;\n    }\n\n    /**\n     * Return current person identifiers required for timetable/requests\n     * @private\n     */\n    private getCurrentPerson(): { personId: number; personType: number; klasseId?: number } {\n        const s = this.getSessionInfo();\n        if (!Number.isInteger(s.personId) || !Number.isInteger(s.personType)) {\n            throw new Error('Session does not contain person identifiers');\n        }\n        return { personId: s.personId!, personType: s.personType!, klasseId: s.klasseId };\n    }\n\n    /**\n     *\n     * @returns {string}\n     * @private\n     */\n    _buildCookies() {\n        let cookies = [];\n        const s = this.getSessionInfo();\n        cookies.push(serialize('JSESSIONID', s.sessionId!));\n        cookies.push(serialize('schoolname', this.schoolbase64));\n        return cookies.join('; ');\n    }\n\n    /**\n     * Get JWT Token\n     * @private\n     */\n    async _getJWT(validateSession = true): Promise<string> {\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch('/WebUntis/api/token/new', {\n            method: 'GET',\n\n            headers: {\n                //Authorization: `Bearer ${this._getToken()}`,\n                Cookie: this._buildCookies(),\n            },\n            expectText: true,\n        });\n\n        if (typeof response !== 'string')\n            throw new Error(`Server returned invalid data: expected string token, got ${typeof response}`);\n\n        this.getSessionInfo().jwt_token = response;\n        return response;\n    }\n\n    /**\n     * Checks if your current WebUntis Session is valid\n     */\n    async validateSession(): Promise<boolean> {\n        if (!this.sessionInformation) return false;\n\n        const response = await this._fetch('/WebUntis/jsonrpc.do', {\n            method: 'POST',\n\n            searchParams: {\n                school: this.school,\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n\n            body: {\n                id: this.id,\n                method: 'getLatestImportTime',\n                params: {},\n                jsonrpc: '2.0',\n            },\n        });\n\n        return typeof response.result === 'number';\n    }\n\n    /**\n     * Get the time when WebUntis last changed its data\n     * @param {Boolean} [validateSession=true]\n     */\n    async getLatestImportTime(validateSession = true): Promise<number> {\n        return this._request('getLatestImportTime', {}, validateSession);\n    }\n\n    /**\n     *\n     * @param id\n     * @param type\n     * @param startDate\n     * @param endDate\n     * @param validateSession\n     * @private\n     */\n    private async _timetableRequest(\n        id: string | number,\n        type: number,\n        startDate?: Date | null,\n        endDate?: Date | null,\n        validateSession = true,\n    ): Promise<Lesson[]> {\n        const additionalOptions: Record<string, unknown> = {};\n        if (startDate) {\n            additionalOptions.startDate = Base.convertDateToUntis(startDate);\n        }\n        if (endDate) {\n            additionalOptions.endDate = Base.convertDateToUntis(endDate);\n        }\n\n        return this._request(\n            'getTimetable',\n            {\n                options: {\n                    id: new Date().getTime(),\n                    element: {\n                        id,\n                        type,\n                    },\n                    ...additionalOptions,\n                    showLsText: true,\n                    showStudentgroup: true,\n                    showLsNumber: true,\n                    showSubstText: true,\n                    showInfo: true,\n                    showBooking: true,\n                    klasseFields: ['id', 'name', 'longname', 'externalkey'],\n                    roomFields: ['id', 'name', 'longname', 'externalkey'],\n                    subjectFields: ['id', 'name', 'longname', 'externalkey'],\n                    teacherFields: ['id', 'name', 'longname', 'externalkey'],\n                },\n            },\n            validateSession,\n        );\n    }\n\n    /**\n     * Get your own Timetable for the current day\n     * Note: You can't use this with anonymous login\n     * @param {Boolean} [validateSession=true]\n     * @returns {Promise<Array>}\n     */\n    async getOwnTimetableForToday(validateSession = true): Promise<Lesson[]> {\n        this._checkAnonymous();\n        const s = this.getSessionInfo();\n        return await this._timetableRequest(s.personId!, s.personType!, null, null, validateSession);\n    }\n\n    /**\n     * Get the timetable of today for a specific element.\n     * @param {number} id\n     * @param {WebUntisElementType} type\n     * @param {Boolean} [validateSession=true]\n     * @returns {Promise<Array>}\n     */\n    async getTimetableForToday(id: number, type: number, validateSession = true): Promise<Lesson[]> {\n        return await this._timetableRequest(id, type, null, null, validateSession);\n    }\n\n    /**\n     * Get your own Timetable for the given day\n     * Note: You can't use this with anonymous login\n     * @param {Date} date\n     * @param {Boolean} [validateSession=true]\n     */\n    async getOwnTimetableFor(date: Date, validateSession = true): Promise<Lesson[]> {\n        this._checkAnonymous();\n        const s = this.getSessionInfo();\n        return await this._timetableRequest(s.personId!, s.personType!, date, date, validateSession);\n    }\n\n    /**\n     * Get the timetable for a specific day for a specific element.\n     * @param {Date} date\n     * @param {number} id\n     * @param {WebUntisElementType} type\n     * @param {Boolean} [validateSession=true]\n     */\n    async getTimetableFor(date: Date, id: number, type: number, validateSession = true): Promise<Lesson[]> {\n        return await this._timetableRequest(id, type, date, date, validateSession);\n    }\n\n    /**\n     * Get your own timetable for a given Date range\n     * Note: You can't use this with anonymous login\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {Boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getOwnTimetableForRange(rangeStart: Date, rangeEnd: Date, validateSession = true): Promise<Lesson[]> {\n        this._checkAnonymous();\n        Base.validateDateRange(rangeStart, rangeEnd, 'getOwnTimetableForRange');\n        const s = this.getSessionInfo();\n        return await this._timetableRequest(s.personId!, s.personType!, rangeStart, rangeEnd, validateSession);\n    }\n\n    /**\n     * Get the timetable for a given Date range for specific element\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {number} id\n     * @param {WebUntisElementType} type\n     * @param {Boolean} [validateSession=true]\n     */\n    async getTimetableForRange(\n        rangeStart: Date,\n        rangeEnd: Date,\n        id: number,\n        type: number,\n        validateSession = true,\n    ): Promise<Lesson[]> {\n        Base.validateDateRange(rangeStart, rangeEnd, 'getTimetableForRange');\n        return await this._timetableRequest(id, type, rangeStart, rangeEnd, validateSession);\n    }\n\n    /**\n     * Get the Timetable of your class for today\n     * Note: You can't use this with anonymous login\n     * @param {Boolean} [validateSession=true]\n     * @returns {Promise<Array>}\n     */\n    async getOwnClassTimetableForToday(validateSession = true): Promise<Lesson[]> {\n        this._checkAnonymous();\n        const s = this.getSessionInfo();\n        return await this._timetableRequest(s.klasseId!, 1, null, null, validateSession);\n    }\n\n    /**\n     * Get the Timetable of your class for the given day\n     * Note: You can't use this with anonymous login\n     * @param {Date} date\n     * @param {Boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getOwnClassTimetableFor(date: Date, validateSession = true): Promise<Lesson[]> {\n        this._checkAnonymous();\n        const s = this.getSessionInfo();\n        return await this._timetableRequest(s.klasseId!, 1, date, date, validateSession);\n    }\n\n    /**\n     * Get the Timetable of your class for a given Date range\n     * Note: You can't use this with anonymous login\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {boolean} [validateSession=true]\n     */\n    async getOwnClassTimetableForRange(rangeStart: Date, rangeEnd: Date, validateSession = true): Promise<Lesson[]> {\n        this._checkAnonymous();\n        Base.validateDateRange(rangeStart, rangeEnd, 'getOwnClassTimetableForRange');\n        const s = this.getSessionInfo();\n        return await this._timetableRequest(s.klasseId!, 1, rangeStart, rangeEnd, validateSession);\n    }\n\n    /**\n     *\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getHomeWorksFor(rangeStart: Date, rangeEnd: Date, validateSession = true): Promise<Homework[]> {\n        Base.validateDateRange(rangeStart, rangeEnd, 'getHomeWorksFor');\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch('/WebUntis/api/homeworks/lessons', {\n            method: 'GET',\n\n            searchParams: {\n                startDate: Base.convertDateToUntis(rangeStart),\n                endDate: Base.convertDateToUntis(rangeEnd),\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof response.data !== 'object')\n            throw new Error(`Server returned invalid data: expected data object, got ${typeof response.data}`);\n\n        if (!response.data['homeworks']) throw new Error(`Data object doesn't contain 'homeworks' field`);\n        return response.data;\n    }\n\n    /**\n     * Converts the untis date string format to a normal JS Date object\n     * @param {string} date Untis date string\n     * @param {Date} [baseDate=new Date()] Base date. Default beginning of current day\n     */\n    static convertUntisDate(date: string, baseDate = startOfDay(new Date())): Date {\n        if (typeof date !== 'string') date = `${date}`;\n        return parse(date, 'yyyyMMdd', baseDate);\n    }\n\n    /**\n     * Convert a untis time string to a JS Date object\n     * @param {string|number} time Untis time string\n     * @param {Date} [baseDate=new Date()] Day used as base for the time. Default: Current date\n     */\n    static convertUntisTime(time: number | string, baseDate = new Date()): Date {\n        if (typeof time !== 'string') time = `${time}`;\n        return parse(time.padStart(4, '0'), 'Hmm', baseDate);\n    }\n\n    /**\n     * Validate that a date range is valid (both Dates and start <= end)\n     * @private\n     */\n    static validateDateRange(rangeStart: Date, rangeEnd: Date, name = 'date range') {\n        if (!(rangeStart instanceof Date) || isNaN(rangeStart.getTime()))\n            throw new Error(`${name}: rangeStart is not a valid Date`);\n        if (!(rangeEnd instanceof Date) || isNaN(rangeEnd.getTime()))\n            throw new Error(`${name}: rangeEnd is not a valid Date`);\n        if (rangeStart.getTime() > rangeEnd.getTime()) throw new Error(`${name}: rangeStart must be <= rangeEnd`);\n    }\n\n    /**\n     * Get all known Subjects for the current logged-in user\n     * @param {boolean} [validateSession=true]\n     */\n    async getSubjects(validateSession = true): Promise<Subject[]> {\n        return await this._request('getSubjects', {}, validateSession);\n    }\n\n    /**\n     * Get the timegrid of current school\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getTimegrid(validateSession = true): Promise<Timegrid[]> {\n        return await this._request('getTimegridUnits', {}, validateSession);\n    }\n\n    /**\n     *\n     * TODO: Find out what type this function returns\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<void>}\n     */\n    async getHomeWorkAndLessons(rangeStart: Date, rangeEnd: Date, validateSession = true): Promise<Array<any>> {\n        Base.validateDateRange(rangeStart, rangeEnd, 'getHomeWorkAndLessons');\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch('/WebUntis/api/homeworks/lessons', {\n            method: 'GET',\n\n            searchParams: {\n                startDate: Base.convertDateToUntis(rangeStart),\n                endDate: Base.convertDateToUntis(rangeEnd),\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof response.data !== 'object')\n            throw new Error(`Server returned invalid data: expected data object, got ${typeof response.data}`);\n\n        if (!response.data['homeworks']) throw new Error(\"Data object doesn't contains homeworks object.\");\n        return response.data;\n    }\n\n    /**\n     * Get Exams for range\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {Number} klasseId\n     * @param {boolean} withGrades\n     * @param {boolean} [validateSession=true]\n     */\n    async getExamsForRange(\n        rangeStart: Date,\n        rangeEnd: Date,\n        klasseId = -1,\n        withGrades = false,\n        validateSession = true,\n    ): Promise<Array<Exam>> {\n        Base.validateDateRange(rangeStart, rangeEnd, 'getExamsForRange');\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch('/WebUntis/api/exams', {\n            method: 'GET',\n\n            searchParams: {\n                startDate: Base.convertDateToUntis(rangeStart),\n                endDate: Base.convertDateToUntis(rangeEnd),\n                klasseId: klasseId,\n                withGrades: withGrades,\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof response.data !== 'object')\n            throw new Error(`Server returned invalid data: expected data object, got ${typeof response.data}`);\n\n        if (!response.data['exams']) throw new Error(`Data object doesn't contain 'exams' field`);\n        return response.data['exams'];\n    }\n\n    /**\n     * Get the timetable for the current week for a specific element from the web client API.\n     * @param {Date} date one date in the week to query\n     * @param {number} id element id\n     * @param {WebUntisElementType} type element type\n     * @param {Number} [formatId=1] set to 1 to include teachers, 2 omits the teachers in elements response\n     * @param {Boolean} [validateSession=true]\n     */\n    async getTimetableForWeek(\n        date: Date,\n        id: number,\n        type: number,\n        formatId = 1,\n        validateSession = true,\n    ): Promise<WebAPITimetable[]> {\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch('/WebUntis/api/public/timetable/weekly/data', {\n            method: 'GET',\n\n            searchParams: {\n                elementType: type,\n                elementId: id,\n                date: format(date, 'yyyy-MM-dd'),\n                formatId: formatId,\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof response.data !== 'object') throw new Error('Server returned invalid data.');\n\n        if (response.data.error) {\n            /* known codes:\n             * - ERR_TTVIEW_NOTALLOWED_ONDATE\n             */\n            const err = new Error('Server responded with error');\n            // TODO: Make this better lol\n            // @ts-ignore\n\n            err.code = response.data.error?.data?.messageKey;\n            throw err;\n        }\n\n        if (!response.data.result?.data?.elementPeriods?.[id]) throw new Error('Invalid response');\n\n        const data = response.data.result.data;\n\n        // TODO: improve typings\n\n        const formatElements = (elements: Array<Record<string, unknown>>, { byType }: { byType: number }) => {\n            const filteredElements = elements.filter((element) => element.type === byType);\n\n            return filteredElements.map((element) => ({\n                ...element,\n                element: data.elements.find(\n                    (dataElement: Record<string, unknown>) =>\n                        dataElement.type === byType && dataElement.id === element.id,\n                ),\n            }));\n        };\n\n        const timetable = data.elementPeriods[id].map((lesson: any) => ({\n            ...lesson,\n            classes: formatElements(lesson.elements, { byType: Base.TYPES.CLASS }),\n            teachers: formatElements(lesson.elements, { byType: Base.TYPES.TEACHER }),\n            subjects: formatElements(lesson.elements, { byType: Base.TYPES.SUBJECT }),\n            rooms: formatElements(lesson.elements, { byType: Base.TYPES.ROOM }),\n            students: formatElements(lesson.elements, { byType: Base.TYPES.STUDENT }),\n        }));\n\n        return timetable;\n    }\n\n    /**\n     * Get the timetable for the current week for the current element from the web client API.\n     * @param {Date} date one date in the week to query\n     * @param {Number} [formatId=1] set to 1 to include teachers, 2 omits the teachers in elements response\n     * @param {Boolean} [validateSession=true]\n     * @returns {Promise<WebAPITimetable[]>}\n     */\n    async getOwnTimetableForWeek(date: Date, formatId = 1, validateSession = true): Promise<WebAPITimetable[]> {\n        this._checkAnonymous();\n        const s = this.getSessionInfo();\n        return await this.getTimetableForWeek(date, s.personId!, s.personType!, formatId, validateSession);\n    }\n\n    /**\n     * Get all known teachers by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getTeachers(validateSession = true): Promise<Teacher[]> {\n        return await this._request('getTeachers', {}, validateSession);\n    }\n\n    /**\n     * Get all known students by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getStudents(validateSession = true): Promise<Student[]> {\n        return await this._request('getStudents', {}, validateSession);\n    }\n\n    /**\n     * Get all known rooms by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getRooms(validateSession = true): Promise<Room[]> {\n        return await this._request('getRooms', {}, validateSession);\n    }\n\n    /**\n     * Get all classes known by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @param {number} schoolyearId\n     * @returns {Promise.<Array>}\n     */\n    async getClasses(validateSession = true, schoolyearId: number): Promise<Klasse[]> {\n        const data = typeof schoolyearId !== 'number' ? {} : { schoolyearId };\n        return await this._request('getKlassen', data, validateSession);\n    }\n\n    /**\n     * Get all departments known by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getDepartments(validateSession = true): Promise<Department[]> {\n        return await this._request('getDepartments', {}, validateSession);\n    }\n\n    /**\n     * Get all holidays known by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getHolidays(validateSession = true): Promise<Holiday[]> {\n        return await this._request('getHolidays', {}, validateSession);\n    }\n\n    /**\n     * Get all status data known by WebUntis\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise.<Array>}\n     */\n    async getStatusData(validateSession = true): Promise<StatusData> {\n        return await this._request('getStatusData', {}, validateSession);\n    }\n\n    /**\n     * Get the current school year\n     * @param [validateSession=true]\n     * @returns {Promise.<SchoolYear>}\n     */\n    async getCurrentSchoolyear(validateSession = true): Promise<SchoolYear> {\n        const data = await this._request<InternalSchoolYear>('getCurrentSchoolyear', {}, validateSession);\n\n        if (!data) throw new Error('Failed to retrieve current school year');\n\n        return {\n            name: data.name,\n            id: data.id,\n            startDate: Base.convertUntisDate(data.startDate),\n            endDate: Base.convertUntisDate(data.endDate),\n        };\n    }\n\n    /**\n     * Convert a JS Date Object to a WebUntis date string\n     * @param {Date} date\n     * @returns {String}\n     */\n    static convertDateToUntis(date: Date): string {\n        return (\n            date.getFullYear().toString() +\n            (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1).toString() +\n            (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()).toString()\n        );\n    }\n\n    /**\n     * Make a JSON RPC Request with the current session\n     * @param {string} method\n     * @param {Object} [parameter={}]\n     * @param {string} [url='/WebUntis/jsonrpc.do?school=SCHOOL']\n     * @param {boolean} [validateSession=true] Whether the session should be checked first\n     * @returns {Promise.<any>}\n     * @private\n     */\n    async _request<Response = Record<string, any>>(\n        method: string,\n        parameter: Record<string, any> = {},\n        validateSession = true,\n        url = `/WebUntis/jsonrpc.do`,\n    ): Promise<Response> {\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n\n        const response = await this._fetch(url, {\n            method: 'POST',\n\n            searchParams: {\n                school: this.school,\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n\n            body: {\n                id: this.id,\n                method: method,\n                params: parameter,\n                jsonrpc: '2.0',\n            },\n        });\n\n        if (!response.result) throw new Error(\"Server didn't return any result.\");\n        if (response.result.code) throw new Error('Server returned error code: ' + response.result.code);\n        return response.result;\n    }\n\n    /**\n     * Returns all the Lessons where you were absent including the excused one!\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {Integer} [excuseStatusId=-1]\n     * @param {boolean} [validateSession=true]\n     * @returns {Promise<Absences>}\n     */\n    async getAbsentLesson(\n        rangeStart: Date,\n        rangeEnd: Date,\n        excuseStatusId = -1,\n        validateSession = true,\n    ): Promise<Absences> {\n        Base.validateDateRange(rangeStart, rangeEnd, 'getAbsentLesson');\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n        this._checkAnonymous();\n\n        const response = await this._fetch('/WebUntis/api/classreg/absences/students', {\n            method: 'GET',\n\n            searchParams: {\n                startDate: Base.convertDateToUntis(rangeStart),\n                endDate: Base.convertDateToUntis(rangeEnd),\n                studentId: this.getCurrentPerson().personId,\n                excuseStatusId: excuseStatusId,\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (response.data == null) throw new Error('Server returned no data!');\n        return response.data;\n    }\n\n    /**\n     * Returns a URL to a unique PDF of all the lessons you were absent\n     * @param {Date} rangeStart\n     * @param {Date} rangeEnd\n     * @param {boolean} [validateSession=true]\n     * @param {Integer} [excuseStatusId=-1]\n     * @param {boolean} [lateness=true]\n     * @param {boolean} [absences=true]\n     * @param {boolean} [excuseGroup=2]\n     */\n    async getPdfOfAbsentLesson(\n        rangeStart: Date,\n        rangeEnd: Date,\n        validateSession = true,\n        excuseStatusId = -1,\n        lateness = true,\n        absences = true,\n        excuseGroup = 2,\n    ): Promise<string> {\n        Base.validateDateRange(rangeStart, rangeEnd, 'getPdfOfAbsentLesson');\n        if (validateSession && !(await this.validateSession())) throw new Error('Current Session is not valid');\n        this._checkAnonymous();\n\n        const response = await this._fetch('/WebUntis/reports.do', {\n            method: 'GET',\n\n            searchParams: {\n                name: 'Excuse',\n                format: 'pdf',\n                rpt_sd: Base.convertDateToUntis(rangeStart),\n                rpt_ed: Base.convertDateToUntis(rangeEnd),\n                excuseStatusId: excuseStatusId,\n                studentId: this.getCurrentPerson().personId,\n                withLateness: lateness,\n                withAbsences: absences,\n                execuseGroup: excuseGroup,\n            },\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        const res = response.data;\n        if (res.error) throw new Error('Server returned no data!');\n        const pdfDownloadURL =\n            this.baseurl + 'WebUntis/reports.do?' + 'msgId=' + res.messageId + '&' + res.reportParams;\n        return pdfDownloadURL;\n    }\n}\n\n/**\n * @private\n */\nexport class InternalWebuntisSecretLogin extends Base {\n    constructor(\n        school: string,\n        username: string,\n        password: string,\n        baseurl?: string,\n        identity = 'Awesome',\n        disableUserAgent = false,\n    ) {\n        super(school, username, password, baseurl, identity, disableUserAgent);\n    }\n\n    async _otpLogin(token: number | string, username: string, time: number, skipSessionInfo = false) {\n        const response = await this._fetchRaw('/WebUntis/jsonrpc_intern.do', {\n            method: 'POST',\n\n            searchParams: {\n                m: 'getUserData2017',\n                school: this.school,\n                v: 'i2.2',\n            },\n\n            body: {\n                id: this.id,\n                method: 'getUserData2017',\n                params: [\n                    {\n                        auth: {\n                            clientTime: time,\n                            user: username,\n                            otp: token,\n                        },\n                    },\n                ],\n                jsonrpc: '2.0',\n            },\n        });\n\n        const responseData = await response.json();\n        if (responseData && responseData.error)\n            throw new Error('Failed to login. ' + (responseData.error.message || ''));\n        const setCookieHeader = response.headers.get('set-cookie');\n        if (!setCookieHeader) throw new Error(`Failed to login. Server didn't return a set-cookie`);\n        const sessionId = this._getCookieFromSetCookie([setCookieHeader]);\n        if (!sessionId) throw new Error(\"Failed to login. Server didn't return a session id.\");\n\n        // Set session temporary\n        this.sessionInformation = {\n            sessionId: sessionId,\n        };\n        if (skipSessionInfo) return this.sessionInformation;\n\n        // Get personId & personType\n        const appConfigUrl = `/WebUntis/api/app/config`;\n\n        const configResponse = await this._fetch(appConfigUrl, {\n            method: 'GET',\n\n            headers: {\n                Cookie: this._buildCookies(),\n            },\n        });\n\n        if (typeof configResponse !== 'object' || typeof configResponse.data !== 'object')\n            throw new Error('Failed to fetch app config while login. data (type): ' + typeof configResponse);\n        // Path -> data.loginServiceConfig.user.persons -> find person with id\n        if (\n            configResponse.data &&\n            configResponse.data.loginServiceConfig &&\n            configResponse.data.loginServiceConfig.user &&\n            !Number.isInteger(configResponse.data.loginServiceConfig.user.personId)\n        )\n            throw new Error('Invalid personId. personId: ' + configResponse.data.loginServiceConfig.user.personId);\n        const webUntisLoginServiceUser = configResponse.data.loginServiceConfig.user;\n        if (!Array.isArray(webUntisLoginServiceUser.persons))\n            throw new Error('Invalid person array. persons (type): ' + typeof webUntisLoginServiceUser.persons);\n        const person = webUntisLoginServiceUser.persons.find(\n            (value: Record<string, unknown>) => value.id === configResponse.data.loginServiceConfig.user.personId,\n        );\n        if (!person) throw new Error('Can not find person in person array.');\n        if (!Number.isInteger(person.type)) throw new Error('Invalid person type. type (type): ' + person.type);\n        this.sessionInformation = {\n            sessionId: sessionId,\n            personType: person.type,\n\n            personId: configResponse.data.loginServiceConfig.user.personId,\n        };\n        // Get klasseId\n        try {\n            const dayConfigUrl = `/WebUntis/api/daytimetable/config`;\n\n            const dayConfigResponse = await this._fetch(dayConfigUrl, {\n                method: 'GET',\n\n                headers: {\n                    Cookie: this._buildCookies(),\n                },\n            });\n\n            if (typeof dayConfigResponse !== 'object' || typeof dayConfigResponse.data !== 'object') throw new Error();\n\n            if (!Number.isInteger(dayConfigResponse.data.klasseId)) throw new Error();\n            this.sessionInformation = {\n                sessionId: sessionId,\n                personType: person.type,\n\n                personId: configResponse.data.loginServiceConfig.user.personId,\n                klasseId: dayConfigResponse.data.klasseId,\n            };\n        } catch (e) {\n            // klasseId is not important. This request can fail\n            // Log the error for diagnostics but don't fail the login\n            // eslint-disable-next-line no-console\n            console.warn('Failed to fetch klasseId during login (non-fatal):', e);\n        }\n        return this.sessionInformation;\n    }\n\n    /**\n     *\n     * @param {Array} setCookieArray\n     * @param {string} [cookieName=\"JSESSIONID\"]\n     * @return {string|boolean}\n     * @private\n     */\n    _getCookieFromSetCookie(setCookieArray?: string[], cookieName = 'JSESSIONID') {\n        if (!setCookieArray) return;\n        for (let i = 0; i < setCookieArray.length; i++) {\n            const setCookie = setCookieArray[i];\n            if (!setCookie) continue;\n            let cookieParts = setCookie.split(';');\n            if (!cookieParts || !Array.isArray(cookieParts)) continue;\n            for (let cookie of cookieParts) {\n                cookie = cookie.trim();\n                cookie = cookie.replace(/;/gm, '');\n                const [Key, Value] = cookie.split('=');\n                if (!Key || !Value) continue;\n                if (Key === cookieName) return Value;\n            }\n        }\n    }\n}\n","import { InternalWebuntisSecretLogin } from './base';\nimport type { authenticator } from 'otplib';\n\nexport type Authenticator = typeof authenticator;\n\nexport class WebUntisSecretAuth extends InternalWebuntisSecretLogin {\n    private readonly secret: string;\n    private authenticator?: Authenticator;\n\n    /**\n     * @augments WebUntis\n     * @param {string} school The school identifier\n     * @param {string} user\n     * @param {string} secret\n     * @param {string} baseurl Just the host name of your WebUntis (Example: [school].webuntis.com)\n     * @param {string} [identity=\"Awesome\"] A identity like: MyAwesomeApp\n     * @param {Object} authenticator Custom otplib v12 instance. Default will use the default otplib configuration.\n     * @param {boolean} [disableUserAgent=false] If this is true, axios will not send a custom User-Agent\n     */\n    constructor(\n        school: string,\n        user: string,\n        secret: string,\n        baseurl: string,\n        identity = 'Awesome',\n        authenticator: Authenticator,\n        disableUserAgent = false,\n    ) {\n        super(school, user, null as unknown as string, baseurl, identity, disableUserAgent);\n        this.secret = secret;\n        this.authenticator = authenticator;\n        if (!authenticator) {\n            // Try to load synchronously if `require` is available (CJS).\n            // Otherwise defer loading to `login()` via dynamic import.\n            try {\n                if (typeof (globalThis as any).require === 'function') {\n                    // eslint-disable-next-line @typescript-eslint/no-var-requires\n                    const otplib = (globalThis as any).require('otplib');\n                    this.authenticator = otplib.authenticator;\n                }\n            } catch (error) {\n                // ignore synchronous require failure; we'll attempt dynamic import during login\n                // eslint-disable-next-line no-console\n                console.warn('Could not require otplib synchronously; will try dynamic import at login:', error);\n            }\n        }\n    }\n\n    // @ts-ignore\n    async login() {\n        // Get JSESSION\n        if (!this.authenticator) {\n            // Try dynamic import in ESM contexts\n            try {\n                const mod = await import('otplib');\n                this.authenticator = (mod as any).authenticator;\n            } catch (e) {\n                throw new Error('otplib is required for secret auth but could not be loaded.');\n            }\n        }\n        const token = this.authenticator!.generate(this.secret);\n        const time = new Date().getTime();\n        if (this.username == null) throw new Error('No username provided for login.');\n        return await this._otpLogin(token, this.username, time);\n    }\n}\n","import { WebUntisSecretAuth } from './secret';\nimport type { Authenticator } from './secret';\nimport type { URL } from 'url';\n\n/**\n * @private\n */\nexport type URLClass = typeof URL;\n\nexport class WebUntisQR extends WebUntisSecretAuth {\n    /**\n     * Use the data you get from a WebUntis QR code\n     * @param {string} QRCodeURI A WebUntis uri. This is the data you get from the QR Code from the webuntis webapp under profile->Data access->Display\n     * @param {string} [identity=\"Awesome\"]  A identity like: MyAwesomeApp\n     * @param {Object} authenticator Custom otplib v12 instance. Default will use the default otplib configuration.\n     * @param {Object} URL Custom whatwg url implementation. Default will use the nodejs implementation.\n     * @param {boolean} [disableUserAgent=false] If this is true, axios will not send a custom User-Agent\n     */\n    constructor(\n        QRCodeURI: string,\n        identity: string,\n        authenticator: Authenticator,\n        URL?: URLClass,\n        disableUserAgent = false,\n    ) {\n        let URLImplementation = URL;\n        if (!URL) {\n            // Prefer global URL (browsers / modern Node). Fall back to require('url') in CJS.\n            if (typeof (globalThis as any).URL === 'function') {\n                URLImplementation = (globalThis as any).URL as unknown as URLClass;\n            } else if (typeof (globalThis as any).require === 'function') {\n                try {\n                    // eslint-disable-next-line @typescript-eslint/no-var-requires\n                    const urlModule = (globalThis as any).require('url');\n                    URLImplementation = urlModule.URL as URLClass;\n                } catch (error) {\n                    throw new Error('Failed to load url module: ' + (error as Error).message);\n                }\n            } else {\n                throw new Error('You need to provide the URL object by yourself. Could not obtain URL implementation.');\n            }\n        }\n\n        if (!URLImplementation) {\n            throw new Error('URL implementation is not available.');\n        }\n        const URLImpl = URLImplementation as URLClass;\n        const uri = new URLImpl(QRCodeURI);\n        super(\n            uri.searchParams.get('school')!,\n            uri.searchParams.get('user')!,\n            uri.searchParams.get('key')!,\n            uri.searchParams.get('url')!,\n            identity,\n            authenticator,\n            disableUserAgent,\n        );\n    }\n}\n","import { InternalWebuntisSecretLogin } from './base';\n\nexport class WebUntisAnonymousAuth extends InternalWebuntisSecretLogin {\n    /**\n     * Default OTP used by some WebUntis servers for anonymous access.\n     * Kept as a constant for backward compatibility but can be overridden\n     * via the constructor `otp` parameter if a different value is required.\n     */\n    static readonly DEFAULT_OTP = 100170;\n\n    private anonymousOtp: number;\n\n    /**\n     *\n     * @param {string} school\n     * @param {string} baseurl\n     * @param {string} [identity='Awesome']\n     * @param {boolean} [disableUserAgent=false] If this is true, axios will not send a custom User-Agent\n     * @param {number} [otp] Optional OTP to use for anonymous login. If omitted, `DEFAULT_OTP` is used.\n     */\n    constructor(school: string, baseurl: string, identity = 'Awesome', disableUserAgent = false, otp?: number) {\n        // Use empty strings for username/password for anonymous login.\n        super(school, '', '', baseurl, identity, disableUserAgent);\n        this.username = '#anonymous#';\n        this.anonymous = true;\n        this.anonymousOtp = typeof otp === 'number' ? otp : WebUntisAnonymousAuth.DEFAULT_OTP;\n    }\n\n    override async login() {\n        // Check whether the school has public access or not\n        const url = `/WebUntis/jsonrpc_intern.do`;\n\n        const requestUrl = `${this.baseurl}${url}?m=getAppSharedSecret&school=${encodeURIComponent(this.school)}&v=i3.5`;\n        const requestBody = {\n            id: this.id,\n            method: 'getAppSharedSecret',\n            params: [\n                {\n                    userName: '#anonymous#',\n                    password: '',\n                },\n            ],\n            jsonrpc: '2.0',\n        };\n\n        const response = await this._fetch(requestUrl, {\n            method: 'POST',\n\n            body: requestBody,\n        });\n\n        if (response.error) throw new Error('Failed to login. ' + (response.error.message || ''));\n\n        // Use configured OTP; default kept for compatibility with servers that expect it.\n        const otp = this.anonymousOtp;\n        const time = new Date().getTime();\n        return await this._otpLogin(otp, this.username, time, true);\n    }\n}\n"],"names":["WebUntisDay","WebUntisElementType","fnsParse","__publicField","startOfDay","format"],"mappings":"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"}